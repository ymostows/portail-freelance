// 1. Config standard
generator client {
  provider = "prisma-client-js"
  // On a retiré la ligne 'output' pour utiliser le standard node_modules
}

// 2. Connexion sécurisée avec Supabase
datasource db {
  provider  = "postgresql"
}

// --- ENUMS ---

enum UserRole {
  FREELANCE
  CLIENT
}

enum ProjectStatus {
  PROPOSAL  // En proposition/devis
  ACTIVE    // En cours
  COMPLETED // Terminé
  ARCHIVED  // Archivé
}

// --- MODELS ---

model User {
  id        String   @id // ID géré par Supabase Auth
  email     String   @unique
  firstName String?
  lastName  String?
  role      UserRole @default(CLIENT)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  projectsOwned Project[] @relation("FreelanceOwner")
  projectsAsClient Project[] @relation("ClientGuest")

  projectLogs ProjectLog[]
  documents   Document[]
}

model Project {
  id          String        @id @default(uuid())
  title       String
  description String?
  dueDate     DateTime?
  status      ProjectStatus @default(PROPOSAL) // Utilisation de l'Enum
  
  objective String?  // Peut être null
  deadline  DateTime?
  budget    String?  // Peut être null

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  freelancerId String
  freelancer   User   @relation("FreelanceOwner", fields: [freelancerId], references: [id])

  inviteToken String? @unique
  clientId     String?
  client       User?   @relation("ClientGuest", fields: [clientId], references: [id])

  projectLogs ProjectLog[]
  documents   Document[]
}

model ProjectLog {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())

  projectId String
  project   Project  @relation(fields: [projectId], references: [id])

  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
}

model Document {
  id        String   @id @default(uuid())
  name      String
  type      String
  size      Int
  path      String
  createdAt DateTime @default(now())

  projectId String
  project   Project  @relation(fields: [projectId], references: [id])

  uploaderId String
  uploader   User    @relation(fields: [uploaderId], references: [id])
}